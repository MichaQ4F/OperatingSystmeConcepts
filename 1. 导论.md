## 1.1 操作系统功能
从系统的角度看待计算机：
1. 将操作系统看做资源分配器`(resource allocator)`，操作系统管理如CPU时间、存储空间、I/O设备等资源，使计算机系统能高效的执行任务。
2. 将操作系统看做是控制程序`(control program)`，用来管理用户程序的执行，防止计算机资源的错误或不当使用。这个角度更注重I/O设备的运行和控制。     

操作系统的定义：
操作系统是一直运行在计算机上的程序，通常称为内核`(kernel)`。除了内核外，还有两类程序：系统程序`(system program)`和应用程序。系统程序与系统运行有关，但不是内核的一部分。
如今构成操作系统的特征的数量正在增加，如移动操作系统（IOS & Android），除了内核外还有中间件`(middleware)`来支持数据、多媒体、图形等。
## 1.2 计算机系统的组成
计算机系统由CPU和若干个设备控制器，通过总线`(bus)`相连而成。    

通常操作系统为每个设备控制器提供一个设备驱动程序`(Device Driver Program)`。设备驱动程序负责设备控制器，并为操作系统的其他部分提供统一的设备访问接口。     

CPU与设备控制器可以并发执行，并且竞争访问内存。通常通过内存控制器协调访问内存。
### 1.2.1 中断操作
控制器通过中断操作通知设备驱动程序已经完成操作。
```
1. 中断操作信号由控制器发出
2. 操作由设备驱动程序执行
3. 触发方式：硬件通过总线发送信号到CPU触发中断。CPU被中断时，停止正在执行的任务，并立即转到固定位置(通常是中断服务程序开始的地址)继续执行，执行完成后，CPU重新执行被中断的计算。
4. 为了快速处理中断，通常将各种设备的中断处理程序地址或中断向量(interupt vector)保存在指针表中，而指针表存储在低内存地址中(通常为100左右的位置)。通过指针表可以间接调用中断处理程序，而无需通过其他中间程序，以此加快中断处理速度。
5. 中断架构应保存任何被中断的状态信息，以便在处理中断后恢复信息，确保被中断的计算能够继续执行，就像中断没有发生一样。
```
    
中断通过CPU硬件中的`中断请求线（Interrupt-Request Line, IRL）`完成。CPU在执行完每条指令后，都会检测中断请求线，当中断请求线中有控制器发送的中断信号时，CPU读取中断信号，并将读取的中断号码作为中断向量的索引，跳转到中断处理程序。中断处理程序在执行过程中保存将要改变的任何状态，在中断操作结束后恢复状态，以便CPU继续执行中断前的操作。
```
设备控制器通过中断请求线发送信号引起(raise)中断，CPU捕获(catch)中断，并且分派(dispatch)到中断处理程序，中断处理程序通过处理设备来清除(clear)中断。
```
以上描述的基本中断机制可以使CPU响应异步事件。
    
现代操作系统需要更复杂的中断处理功能：
1. 在关键处理时，需要能够延迟处理中断。
2. 需要一种有效方式，以便分派中断到合适的中断处理程序。
3. 需要多级中断，以便操作系统能够区分高优先级或低优先级的中断，能够根据紧迫程度进行响应。
     
以上三个功能在现代计算机中通过CPU和`中断控制器硬件(interrupt-controller-hard-ware)`实现。
CPU通常有两条中断请求线，一条是`非屏蔽中断(nonmaskable interrupt)`，保存如不可恢复的内存错误等事件，另一条是`可屏蔽中断(maskable interrput)`，在执行不得中断的关键指令序列之前，它可由CPU关闭。设备控制器使用可屏蔽中断请求服务。
由于计算机设备及相应的中断处理程序常常多于中断向量内的地址，所以通常采用`中断链(interrupt chaining)`技术平衡巨大的中断向量表开销和分派到单个中断处理程序的低效。具体做法是中断向量中每个元素指向中断处理程序链表的表头，当中断发生时，相应链表的中断程序被一一调用，直到发现可以处理这个中断请求的程序为止。    

中断机制还实现了一个`中断优先级(interrupt prioity level)`系统，该系统可以使CPU延迟处理低优先级中断而不屏蔽所有中断，并且可以让高优先级级中断抢占低优先级中断。

### 1.2.2 存储结构

CPU只能从内存在加载命令，故程序应先放入内存中。通用计算机运行的大多数程序通常位于可读写内存中，称为`主存(main memory)`或`随机存取存储器(Random Access Memeory,RAM)`。主存通常为`动态随机存取存储器(Dynamic Random Access Memory,DRAM)`。